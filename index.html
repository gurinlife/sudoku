<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="assets/css/build/style.css">

    <title>Sudoku</title>
  </head>
  <body>
    <h1>Game Sudoku</h1>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <div class="text-center">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="?diff=easy" class="btn btn-outline-secondary btn-sm diff easy">Easy</a></li>
                        <li class="list-inline-item"><a href="?diff=medium" class="btn btn-outline-secondary btn-sm diff medium">Medium</a></li>
                        <li class="list-inline-item"><a href="?diff=hard" class="btn btn-outline-secondary btn-sm diff hard">Hard</a></li>
                    </ul>
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="?diff=very-hard" class="btn btn-outline-secondary btn-sm diff very-hard">Very Hard</a></li>
                        <li class="list-inline-item"><a href="?diff=insane" class="btn btn-outline-secondary btn-sm diff insane">Insane</a></li>
                        <li class="list-inline-item"><a href="?diff=inhuman" class="btn btn-outline-secondary btn-sm diff inhuman">Inhuman</a></li>
                    </ul>
                </div>
                <table id="__sudoku_table" class="table table-bordered">
                </table>
                <div id="__message" class="text-center mb-3 font-weight-bold"></div>
                <div class="text-center">
                    <button type="button" onclick="validate_sudoku();" class="btn btn-primary" style="display: none;">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js"></script>
    <script src="assets/js/sudoku.js"></script>

    <script>
        window.onbeforeunload = function() {
            return "Changes you made may not be saved.";
        }

        function getSearchParameters() {
            var prmstr = window.location.search.substr(1);
            return prmstr != null && prmstr != "" ? transformToAssocArray(prmstr) : {};
        }

        function transformToAssocArray( prmstr ) {
            var params = {};
            var prmarr = prmstr.split("&");
            for ( var i = 0; i < prmarr.length; i++) {
                var tmparr = prmarr[i].split("=");
                params[tmparr[0]] = tmparr[1];
            }
            return params;
        }

        var getParams   = getSearchParameters();
        let data        = '';
        let inputNumber = [];
        let sudokuTable = document.getElementById('__sudoku_table');

        if (getParams.diff) {
            const arrData = sudoku.board_string_to_grid(sudoku.generate(getParams.diff));

            for (let i = 0; i < 9; i++) {
                inputNumber.push(`<tr>`);

                for (let j = 0; j < 9; j++) {
                    inputNumber.push(`<td><input type="tel" class="form-control" value="${(arrData[i][j] != '.') ? arrData[i][j] : ''}"></td>`);
                }

                inputNumber.push(`</tr>`);
            }

            sudokuTable.innerHTML = inputNumber.join('');     
            $('[type="button"]').show();

            $('.diff').removeClass('btn-outline-secondary');
            $('.diff').addClass('btn-outline-secondary');
            $('.diff.'+getParams.diff).removeClass('btn-outline-secondary');
            $('.diff.'+getParams.diff).addClass('btn-secondary');
        }

        function validate_sudoku() {
            let inputData = '';
            let is_solved = true;

            $('.form-control').each(function() {
                if ($(this).val().length > 0) {
                    inputData += $(this).val();
                } else {
                    inputData += '.';

                    is_solved = false;
                }
            });

            if (is_solved) {
                if (!sudoku.solve(inputData)) {
                    is_solved = false;
                }
                
            }

            if (is_solved) {
                $('#__message').html('<span class="text-success">Sukses! Reload untuk main lagi.</span>');
            } else {
                $('#__message').html('<span class="text-danger">Masih ada yang salah, coba cek kembali.</span>');
            }
        }
    </script>
  </body>
</html>